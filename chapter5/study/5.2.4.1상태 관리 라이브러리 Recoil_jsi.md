# 5ì¥ ë¦¬ì•¡íŠ¸ì™€ ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬

### 5.2.4.1 ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ Recoil ì‚´í´ë³´ê¸°

### 3. useRecoilValue

ğŸ¤” **useRecoilValue** : `atom`ì˜ ê°’ì„ ì½ì–´ì˜¤ëŠ” í›…

```js
const statements = useRecoilValue(statementsAtom);
```

ğŸ¤” **useRecoilValue í›…ì˜ êµ¬í˜„**

1. `useRecoilValue` í•¨ìˆ˜

   - ê°œë°œ í™˜ê²½ í™•ì¸
   - Recoil ìŠ¤í† ì–´ ì°¸ì¡° ë° ë¡œë“œ ê°€ëŠ¥í•œ ìƒíƒœ ì–»ê¸°
   - ë¡œë“œ ê°€ëŠ¥í•œ(Loadable) ìƒíƒœ ì²˜ë¦¬

```ts
// useRecoilValue
function useRecoilValue<T>(recoilValue: RecoilValue<T>): T {
  if (__DEV__) {
    // __DEV__ ë³€ìˆ˜ëŠ” ê°œë°œ í™˜ê²½ì—ì„œ íŠ¹ì • í™•ì¸ ë˜ëŠ” ë™ì‘ì„ í™œì„±í™” ë˜ëŠ” ë¹„í™œì„±í™”í•˜ëŠ” ë° ì‚¬ìš©
    validateRecoilValue(recoilValue, "useRecoilValue");
  }
  const storeRef = useStoreRef(); // Recoil ìŠ¤í† ì–´ì— ëŒ€í•œ ì°¸ì¡°. atom ë° selector
  const loadable = useRecoilValueLoadable(recoilValue); // Loadable: ë¡œë“œ ê°€ëŠ¥í•œ ìƒíƒœ. Recoil ê°’ì˜ ë¹„ë™ê¸° ìƒíƒœë¥¼ ë‚˜íƒ€ë‚´ë©° ë¡œë“œ ì¤‘ì¸ì§€, ì˜¤ë¥˜ê°€ ìˆëŠ”ì§€, ê°’ì´ ìˆëŠ”ì§€ë¥¼ í¬í•¨
  return handleLoadable(lodable, recoilValue, storeRef); // Recoil ê°’ì˜ ë‹¤ì–‘í•œ ìƒíƒœ(ë¡œë”© ì¤‘, ì˜¤ë¥˜, ê°’ì´ ìˆëŠ” ìƒíƒœ)ë¥¼ ì²˜ë¦¬í•˜ê³  ì ì ˆí•œ ê²°ê³¼ë¥¼ ë°˜í™˜
}
```

<br>

2. `useRecoilValueLoadable_LEGACY` í•¨ìˆ˜
   - Recoil ê°’ì˜ ìƒíƒœ ì´ˆê¸°í™”
   - ì»´í¬ë„ŒíŠ¸ ì´ë¦„ ë° ë¡œë“œ ê°€ëŠ¥í•œ ìƒíƒœ ì–»ê¸°
   - ë¡œë“œ ê°€ëŠ¥í•œ(Loadable) ìƒíƒœ ë° ì´ì „ ë¡œë“œ ê°€ëŠ¥í•œ ìƒíƒœ ê¸°ë¡
   - Recoil ê°’ ë³€ê²½ì„ êµ¬ë…í•˜ê³ , ë³€ê²½ì´ ê°ì§€ë  ë•Œ ì»´í¬ë„ŒíŠ¸ë¥¼ ë‹¤ì‹œ ë Œë”ë§
   - í ë° ì½œë°± ì„¤ì • (deprecated)
   - í´ë¦°ì—… í•¨ìˆ˜
   - ê²°ê³¼ ë°˜í™˜

```ts
// useRecoilValueLoadable
// Recoil ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” React ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ Recoil ê°’ì˜ ë¡œë“œ ê°€ëŠ¥í•œ(Loadable) ìƒíƒœë¥¼ ì²˜ë¦¬
function useRecoilValueLoadable_LEGACY<T>(
  recoilValue: RecoilValue<T>
): Lodable<T> {
  // Recoil ê°’ì˜ ìƒíƒœê°€ ë³€ê²½ì‹œ ê°•ì œë¡œ ì»´í¬ë„ŒíŠ¸ë¥¼ ë‹¤ì‹œ ë Œë”ë§í•˜ê¸° ìœ„í•œ ìš©ë„ë¡œ ì‚¬ìš©
  const storeRef = useStoreRef<T>;
  const [, forceUpdate] = useState([]);

  // ì»´í¬ë„ŒíŠ¸ ì´ë¦„ ë° ë¡œë“œ ê°€ëŠ¥í•œ ìƒíƒœ ì–»ê¸°
  const componentName = useComponentName(); // í˜„ì¬ ì»´í¬ë„ŒíŠ¸ì˜ ì´ë¦„
  // getLoadable : í˜„ì¬ Recoil ê°’ì˜ ë¡œë“œ ê°€ëŠ¥í•œ(Loadable) ìƒíƒœë¥¼ ì–»ê¸° ìœ„í•œ ìš©ë„
  const getLoadable = useCallback(() => {
    if (__DEV__) {
      recoilComponentGetRecoilValueCount_FOR_TESTING.current++;
    }
    const store = storeRef.current;
    const storeState = store.getState();
    const treeState = reactMode().early
      ? storeState.nextTree ?? storeState.currentTree
      : storeState.currentTree;
    return getRecoilValueAsLoadable(store, recoilValue, treeState);
  }, [storeRef, recoilValue]);

  // ë¡œë“œ ê°€ëŠ¥í•œ(Loadable) ìƒíƒœ ë° ì´ì „ ë¡œë“œ ê°€ëŠ¥í•œ ìƒíƒœ ê¸°ë¡
  // ì´í›„ì— Recoil ê°’ì˜ ë³€ê²½ì„ ê°ì§€í•˜ê³  ì ì ˆí•œ ì•¡ì…˜ì„ ìˆ˜í–‰
  const loadable = getLoadable();
  const prevLoadableRef = useRef(loadable);
  useEffect(() => {
    prevLodableRef.current = loadable;
  });

  // Recoil ê°’ì˜ ë³€ê²½ì„ êµ¬ë…í•˜ê³ , ë³€ê²½ì´ ê°ì§€ë  ë•Œ ì»´í¬ë„ŒíŠ¸ë¥¼ ë‹¤ì‹œ ë Œë”ë§
  useEffect(
    () => {
      const store = storeRef.current;
      const storeState = store.getState();
      // í˜„ì¬ Recoilì˜ ê°’ì„ êµ¬ë…í•˜ëŠ” í•¨ìˆ˜
      const subscription = subscribeToRecoilValue(
        store,
        recoilValue,
        (_state) => {
          // ë Œë”ë§ì„ ì–µì œí•˜ëŠ” ì„¤ì •ì´ ë˜ì–´ìˆì§€ ì•Šë‹¤ë©´
          if (!gkx("recoil_suppress_render_in_callback")) {
            return forceUpdate([]);
          }
          const newLodable = getLoadable();
          // isëŠ” ë‘ ê°ì²´ê°€ ê°™ì€ì§€ ë¹„êµí•˜ê³ , ë‹¤ë¥´ë‹¤ë©´ ë Œë”ë§ì„ ìœ ë„í•œë‹¤.
          if (!prevLoadableRef.current?.is(newLodable)) {
            forceUpdate(newLodable);
          }
          prevLodableRef.current = newLoadable;
        },
        componentName
      );

      // í ë° ì½œë°± ì„¤ì •
      if (storeState.nextTree) {
        // Recoilì˜ ë‹¤ìŒ íŠ¸ë¦¬ê°€ ìˆë‹¤ë©´
        // ë°°ì—´ì— ì½œë°±ì„ ì¶”ê°€í•˜ê³ , ì´ ì½œë°±ì—ì„œ ì´ì „ ë¡œë“œ ê°€ëŠ¥í•œ ìƒíƒœë¥¼ ì´ˆê¸°í™”í•˜ê³  ì»´í¬ë„ŒíŠ¸ë¥¼ ê°•ì œë¡œ ë‹¤ì‹œ ë Œë”ë§
        // queuedComponentCallbasks_DEPRECATTED ë°°ì—´ì´ deprecated (ë” ì´ìƒ ì‚¬ìš© X)
        store.getState().queuedComponentCallbasks_DEPPRECATTED.push(() => {
          prevLodableRef.current = null;
          forceUpdate([]);
        });
      } else {
        if (!gkx("recoil_suppress_render_in_callback")) {
          // ë Œë”ë§ì„ ì–µì œí•˜ëŠ” ì„¤ì •ì´ ë˜ì–´ìˆì§€ ì•Šë‹¤ë©´
          return forceUpdate([]);
        }
        const newLodable = getLodable(); // í˜„ì¬ Recoilì´ ê°€ì§€ê³  ìˆëŠ” ìƒíƒœê°’ì„ ê°€ì§€ê³  ìˆëŠ” í´ë˜ìŠ¤ì¸ lodableì„ ë°˜í™˜
        // ê°’ ë¹„êµ - ë‹¤ë¥´ë‹¤ë©´ forceUpdateë¥¼ ì‹¤í–‰í•œë‹¤.
        if (!prevLodableRef.current?.is(newLoadable)) {
          forceUpdate(newLoadable);
        }
        prevLodableRef.current = newLoadable;
      }

      // í´ë¦°ì—… í•¨ìˆ˜ì— subscribe í•´ì²´í•˜ëŠ” í•¨ìˆ˜ë¥¼ ë°˜í™˜í•œë‹¤.
      return subscription.release;
    },
    componentName,
    getLoadable,
    recoilValue,
    storeRef
  );

  return loadable;
}
```

### 4. useRecoilState

ğŸ¤” **useRecoilState** : `useState`ì™€ ìœ ì‚¬í•˜ê²Œ ê°’ì„ ê°€ì ¸ì˜¤ê³  ë³€ê²½í•˜ëŠ” í›…

```js
function useRecoilState<T>(
  recoilState: RecoilState<T>
): [T, SetterOrUpdater<T>] {
  if (__DEV__) {
    validateRecoilValue(recoilState, "useRecoilState"); // Recoil ìƒíƒœê°€ ìœ íš¨í•œì§€ í™•ì¸
  }

  return [useRecoilValue(recoilState), useSetRecoilState(recoilState)];
}
```

ğŸ¤” **useSetRecoilState í›…**

```js
// useSetRecoilState
/*
  Returns a function that allows the value of a RecoilState to be updated, but does not subscribe the component to changes to that RecoilState
*/

function useSetRecoilState<T>(recoilState: RecoilState<T>): SetterOrUpdate<T> {
  if (__DEV__) {
    validateRecoilValue(recoilState, "useRecoilState"); // Recoil ìƒíƒœê°€ ìœ íš¨í•œì§€ í™•ì¸
  }
  const storeRef = useStoreRef();

  // Setter í•¨ìˆ˜ ë°˜í™˜
  return useCallback(
    (newValueOrUpdater: ((T) => T | DefaultValue) | T | DefaultValue) => {
      setRecoilValue(storeRef.current, recoilState, newValueOrUpdater);
    },
    [storeRef, recoilState]
  );
}
```

ğŸ¤” **setRecoilValue**

- ë‚´ë¶€ì—ì„œ `queueOrPerformStateUpdate` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì—¬ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•˜ê±°ë‚˜ ì—…ë°ì´íŠ¸ê°€ í•„ìš”í•œ ë‚´ìš©ì„ ë“±ë¡í•œë‹¤.

```js
//setRecoilValue
function setRecoilValue<T>(
  store: Store,
  recoilValue: AbstractRecoilValue<T>,
  valueOrUpdater: T | DefaultValue | ((T) => T | DefaultValue)
): void {
  queueOrPerformStateUpdate(store, {
    type: "set",
    recoilValue,
    valueOrUpdater,
  });
}
```

âœ… **Recoil ì‚¬ìš©ë²• ì¢…í•©**

1. ì• í”Œë¦¬ì¼€ì´ì…˜ ìµœìƒë‹¨ì— **`<RecoilRoot/>`** ì„ ì–¸í•˜ì—¬ **í•˜ë‚˜ì˜ ìŠ¤í† ì–´**ë¥¼ ë§Œë“­ë‹ˆë‹¤.
2. **`atom` ìƒíƒœ ë‹¨ìœ„**ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤. (ê³ ìœ í•œ ê°’ì¸ keyë¡œ êµ¬ë³„)
3. ì»´í¬ë„ŒíŠ¸ëŠ” Recoilì—ì„œ ì œê³µí•˜ëŠ” í›…ì„ í†µí•´ **atomì˜ ìƒíƒœ ë³€í™”ë¥¼ êµ¬ë…(subscribe)**í•˜ë©°,
   ê°’ì´ ë³€ê²½ë˜ë©´ forceUpdate ê°™ì€ ê¸°ë²•ì„ í†µí•´ ë¦¬ë Œë”ë§ì„ ì‹¤í–‰í•˜ì—¬ **ìµœì‹  atom ê°’ì„ ê°€ì ¸ì˜µë‹ˆë‹¤**.

### 5. ì‹¤ì œ ì‚¬ìš©

âœ¨ ë¡œì§ ì •ë¦¬í•˜ì—¬ ì—…ë°ì´íŠ¸ í•´ë†“ê² ìŠµë‹ˆë‹¤ !

### 6. íŠ¹ì§•

ğŸ˜€ **ì¥ì **

- ë©”íƒ€(í˜ì´ìŠ¤ë¶) íŒ€ì—ì„œ ì£¼ë„ì ìœ¼ë¡œ ê°œë°œì„ í•˜ê³  ìˆê¸° ë•Œë¬¸ì— ì•ìœ¼ë¡œë„ ê¸°ëŒ€ê°€ ë˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ ì…ë‹ˆë‹¤.
- `seletor`ë¥¼ í•„ë‘ë¡œ ë‹¤ì–‘í•œ ë¹„ë™ê¸° ì‘ì—…ì„ ì§€ì›í•˜ëŠ” APIë¥¼ ì œê³µí•˜ì—¬ `Reduxì™€` ë‹¬ë¦¬ ì¶”ê°€ì ì¸ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ ë¹„ë™ê¸° ì‘ì—…ì„ ìˆ˜ì›”í•˜ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ë¦¬ì•¡íŠ¸ì™€ ë¹„ìŠ·í•œ ìì²´ ê°œë°œ ë„êµ¬ë¥¼ ì§€ì›í•©ë‹ˆë‹¤.

ğŸ˜Ÿ **ë‹¨ì **

- í—ˆë‚˜ ì •ì‹ ë²„ì „ 1.0.0ì˜ ì¶œì‹œ ì‹œì ì´ ë¶ˆí™•ì‹¤í•˜ì—¬ í˜¸í™˜ì„±ì´ ê¹¨ì§€ëŠ” ë“± ë³€ê²½ì‚¬í•­ì´ ë°œìƒí•  ìˆ˜ ìˆëŠ” ì´ˆê¸°ë²„ì „ì´ê¸° ë•Œë¬¸ì— ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.
